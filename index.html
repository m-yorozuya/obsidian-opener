<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Redirecting to Obsidian...</title>
</head>
<body>
    <p id="message">Obsidianを呼び出しています...</p>
    <script>
        const params = new URLSearchParams(window.location.search);
        const vault = params.get('vault');
        const file = params.get('file');
        const mode = params.get('mode');
        const template = params.get('template'); // テンプレート名（任意）

        if (vault && file) {
            let advancedUri;
            const encodedVault = encodeURIComponent(vault);
            const encodedFile = encodeURIComponent(file);

            if (mode === 'new') {
                // 新規作成時：filepath, mode=new を使用。templateがあれば追加。
                advancedUri = `obsidian://advanced-uri?vault=${encodedVault}&filepath=${encodedFile}&mode=new`;
                if (template) {
                    advancedUri += `&template=${encodeURIComponent(template)}&templater=true`;
                }
            } else {
                // 開くとき
                advancedUri = `obsidian://advanced-uri?vault=${encodedVault}&filepath=${encodedFile}`;
            }
            
            window.location.href = advancedUri;
            setTimeout(() => window.close(), 1500);
        }
    </script>
</body>
</html>