<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Redirecting to Obsidian...</title>
</head>
<body>
    <p id="message">Obsidianを呼び出しています...</p>
    <script>
        const params = new URLSearchParams(window.location.search);
        const vault = params.get('vault');
        const file = params.get('file');
        const mode = params.get('mode'); // 'new' か 'open' かを指定

        if (vault && file) {
            let obsidianUri;

            if (mode === 'new') {
                // 新規作成モード：特定のフォルダ（例: Inbox）に作成し、中身にタイトルを入れる設定
                // folderパラメータを追加すれば特定のフォルダ内に作成可能です
                obsidianUri = `obsidian://new?vault=${encodeURIComponent(vault)}&folder=inbox&name=${encodeURIComponent(file)}`;
            } else {
                // 通常のオープンモード
                obsidianUri = `obsidian://open?vault=${encodeURIComponent(vault)}&file=${encodeURIComponent(file)}`;
            }
            
            window.location.href = obsidianUri;

            setTimeout(() => {
                window.close();
            }, 1500);
        } else {
            document.getElementById('message').innerText = "エラー: パラメータ（vault, file）が足りません。";
        }
    </script>
</body>
</html>